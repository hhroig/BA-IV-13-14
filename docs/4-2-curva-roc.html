<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="4.2 Curva ROC | Introducción al Aprendizaje Supervisado" />
<meta property="og:type" content="book" />


<meta property="og:description" content="Sesiones 13-15 IV Edición del Big Analytics: de la información al conocimiento." />


<meta name="author" content="Harold A. Hernández-Roig (hahernan@est-econ.uc3m.es)" />


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="Sesiones 13-15 IV Edición del Big Analytics: de la información al conocimiento.">

<title>4.2 Curva ROC | Introducción al Aprendizaje Supervisado</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introducción"><span class="toc-section-number">1</span> Introducción</a></li>
<li class="has-sub"><a href="2-k-vecinos-más-próximos.html#k---vecinos-más-próximos"><span class="toc-section-number">2</span> K - Vecinos más Próximos</a><ul>
<li><a href="2-1-clasificación-con-el-paquete-class.html#clasificación-con-el-paquete-class"><span class="toc-section-number">2.1</span> Clasificación con el paquete <code>class</code></a></li>
<li class="has-sub"><a href="2-2-el-paquete-caret.html#el-paquete-caret"><span class="toc-section-number">2.2</span> El paquete <code>caret</code></a><ul>
<li><a href="2-2-el-paquete-caret.html#visualización"><span class="toc-section-number">2.2.1</span> Visualización</a></li>
<li><a href="2-2-el-paquete-caret.html#clasificación-con-knn"><span class="toc-section-number">2.2.2</span> Clasificación con KNN</a></li>
<li><a href="2-2-el-paquete-caret.html#importancia-de-las-variables"><span class="toc-section-number">2.2.3</span> Importancia de las variables</a></li>
</ul></li>
<li><a href="2-3-regresión.html#regresión"><span class="toc-section-number">2.3</span> Regresión</a></li>
<li><a href="2-4-weighted-knn.html#weighted-knn"><span class="toc-section-number">2.4</span> Weighted KNN</a></li>
</ul></li>
<li class="has-sub"><a href="3-DA.html#DA"><span class="toc-section-number">3</span> Análisis Discriminante</a><ul>
<li><a href="3-1-LDA.html#LDA"><span class="toc-section-number">3.1</span> Análisis Discriminante Lineal</a></li>
<li><a href="3-2-QDA.html#QDA"><span class="toc-section-number">3.2</span> Análisis Discriminante Cuadrático</a></li>
<li><a href="3-3-RDA.html#RDA"><span class="toc-section-number">3.3</span> Análisis Discriminante Regularizado</a></li>
</ul></li>
<li class="has-sub"><a href="4-compara.html#compara"><span class="toc-section-number">4</span> Comparación entre Modelos</a><ul>
<li><a href="4-1-comparando-según-accuracy.html#comparando-según-accuracy"><span class="toc-section-number">4.1</span> Comparando según <code>Accuracy</code></a></li>
<li class="has-sub"><a href="4-2-curva-roc.html#curva-roc"><span class="toc-section-number">4.2</span> Curva <em>ROC</em></a><ul>
<li><a href="4-2-curva-roc.html#análisis-en-la-muestra-test"><span class="toc-section-number">4.2.1</span> Análisis en la muestra test</a></li>
<li><a href="4-2-curva-roc.html#análisis-en-la-muestra-de-entrenamiento"><span class="toc-section-number">4.2.2</span> Análisis en la muestra de entrenamiento</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="5-wiscon.html#wiscon"><span class="toc-section-number">5</span> Wisconsin Breast-Cancer Data</a><ul>
<li><a href="5-1-comentarios-finales-reducción-de-la-dimensión.html#comentarios-finales-reducción-de-la-dimensión"><span class="toc-section-number">5.1</span> Comentarios finales: reducción de la dimensión</a></li>
</ul></li>
<li><a href="bibliografía.html#bibliografía">Bibliografía</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="curva-roc" class="section level2">
<h2><span class="header-section-number">4.2</span> Curva <em>ROC</em></h2>
<div id="análisis-en-la-muestra-test" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Análisis en la muestra test</h3>
<p>Hasta ahora solo hemos estudiado la precisión de los modelos usando el <code>Accuracy</code>, pero hay un gran número de medidas cuya aplicación está estrechamente ligada a la naturaleza del problema. Por ejemplo, el clasificador de Bayes asigna una observación a la clase con mayor probabilidad <em>a posteriori</em> <span class="math inline">\(p_k(X)\)</span>. Para el problema de los datos <code>Default</code>, donde solo tenemos las clases <code>Yes</code> (el cliente falla en el pago de su tarjeta de crédito) y <code>No</code> (el cliente no falla en el pago), asignamos una observación a la clase <code>Yes</code> si se cumple: <span class="math display">\[ \Pr (\text{ default = Yes} | X = x) &gt; 0.5. \]</span></p>
<p>Pero seguramente el interés del banco es asignar la clase correcta a los malos pagadores y así obtener ganancias, denegando créditos. Esto puede lograrse bajando este <strong>umbral</strong> de <span class="math inline">\(0.5\)</span> a <span class="math inline">\(0.2\)</span>, o sea, asignamos una observación a la clase <code>Yes</code> si: <span class="math display">\[ \Pr (\text{ default = Yes} | X = x) &gt; 0.2. \]</span></p>
<p>Decisiones como estas deben basarse en la experiencia de expertos (e.g. el banco que aprueba el crédito). Vamos a estudiar los tipos de errores que se comenten al variar el umbral de decisión. Para ello, empezamos estimando las probabilidades a posteriori del método LDA en nuestra muestra test:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1"><span class="co"># hagamos las predicciones del conjunto de prueba</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2">pred_prob &lt;-<span class="st"> </span><span class="kw">predict</span>(model_lda_def, <span class="dt">newdata =</span> test_df, <span class="dt">type =</span> <span class="st">&quot;prob&quot;</span>)</a></code></pre></div>
<p>Usamos el paquete <code>ROCR</code> <span class="citation">(Sing et al. <a href="#ref-R-ROCR">2015</a>)</span> para calcular la Curva <em><strong>R</strong>eceiver <strong>O</strong>perating <strong>C</strong>haracteristic</em> (<em>ROC</em>) que compara simultáneamente dos tipos de errores: la <em>Razón de Falsos Positivos</em> (<em>FPR</em>, siglas en inglés) y la <em>Razón de Verdaderos Positivos</em> (<em>TPR</em>, siglas en inglés), para un grid de valores del umbral.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">library</span>(ROCR)</a></code></pre></div>
<pre><code>## Loading required package: gplots</code></pre>
<pre><code>## 
## Attaching package: &#39;gplots&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     lowess</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:gridExtra&#39;:
## 
##     combine</code></pre>
<pre><code>## The following object is masked from &#39;package:MASS&#39;:
## 
##     select</code></pre>
<pre><code>## The following object is masked from &#39;package:GGally&#39;:
## 
##     nasa</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">prob.pred &lt;-<span class="st"> </span><span class="kw">prediction</span>(pred_prob[,<span class="dv">2</span>], test_df<span class="op">$</span>default)</a>
<a class="sourceLine" id="cb152-2" data-line-number="2"></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="co"># ROC</span></a>
<a class="sourceLine" id="cb152-4" data-line-number="4">prob.pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-5" data-line-number="5"><span class="st">  </span><span class="kw">performance</span>(<span class="dt">measure =</span> <span class="st">&quot;tpr&quot;</span>, <span class="dt">x.measure =</span> <span class="st">&quot;fpr&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-6" data-line-number="6"><span class="st">  </span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-63-1.png" width="80%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="co"># AUC: mientras mas cercano a 1, mejor predicciones</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2">auc.lda &lt;-<span class="st"> </span><span class="kw">performance</span>(prob.pred, <span class="dt">measure =</span> <span class="st">&quot;auc&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb153-3" data-line-number="3">auc.lda</a></code></pre></div>
<pre><code>## [1] 0.9526643</code></pre>
<p>El <em>Área bajo la Curva ROC</em> (<em>AUC</em>, siglas en inglés) resume el rendimiento del clasificador, para todos los posibles umbrales. Una curva ROC ideal debería alcanzar el borde superior izquierdo, por tanto, mientras más cercano a 1 esté el AUC, mejor será. En nuestro ejemplo el área es de <span class="math inline">\(0.95\)</span>, lo cual indica muy buen ajuste. Por otro lado, un AUC cercano a 0.5 indica que el clasificador asigna las clases al azar.</p>
<p>Con el mismo paquete podemos representar otras curvas. Por ejemplo, podemos estudiar por separado, y para diferentes umbrales:</p>
<ol style="list-style-type: decimal">
<li>La <em>tasa de error</em> general para diferentes umbrales: <span class="math display">\[ \Pr (\hat{Y} \neq Y) \approx (FP + FN)/(P+N); \]</span>
donde FP: Falsos Positivos, FN: False Negativos, P: Positivos en la muestra (reales) y N: Negativos en la muestra (reales).</li>
</ol>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1">prob.pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb155-2" data-line-number="2"><span class="st">  </span><span class="kw">performance</span>(<span class="st">&quot;err&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb155-3" data-line-number="3"><span class="st">  </span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-64-1.png" width="80%" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: decimal">
<li>La <em>Razón de Verdaderos Positivos</em>: <span class="math display">\[ P(\hat Y = + | Y = +) \approx TP/P;\]</span></li>
</ol>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">prob.pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="st">  </span><span class="kw">performance</span>(<span class="st">&quot;tpr&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-65-1.png" width="80%" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: decimal">
<li>La <em>Razón de Falsos Positivos</em>: <span class="math display">\[ \Pr(\hat Y = + | Y = -) \approx FP/N;\]</span></li>
</ol>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">prob.pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="st">  </span><span class="kw">performance</span>(<span class="st">&quot;fpr&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-3" data-line-number="3"><span class="st">  </span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-66-1.png" width="80%" style="display: block; margin: auto;" /></p>
<ol start="4" style="list-style-type: decimal">
<li>La <em>Razón de Falsos Negativos</em>: <span class="math display">\[ \Pr(\hat Y = - | Y = +) \approx FN/P;\]</span></li>
</ol>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">prob.pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="st">  </span><span class="kw">performance</span>(<span class="st">&quot;fnr&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-3" data-line-number="3"><span class="st">  </span><span class="kw">plot</span>()</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-67-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Toda la información sobre los errores podemos representarla en un mismo gráfico y así ver el equilibrio entre error y umbral:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="co"># Podemos combinar las 3 ultimas en un mismo grafico</span></a>
<a class="sourceLine" id="cb159-2" data-line-number="2">df_perfor &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Error.Rate =</span> <span class="kw">performance</span>(prob.pred, <span class="st">&quot;err&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb159-3" data-line-number="3">                        <span class="dt">FNR =</span> <span class="kw">performance</span>(prob.pred, <span class="st">&quot;fnr&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb159-4" data-line-number="4">                        <span class="dt">FPR =</span> <span class="kw">performance</span>(prob.pred, <span class="st">&quot;fpr&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb159-5" data-line-number="5">                        <span class="dt">TPR =</span> <span class="kw">performance</span>(prob.pred, <span class="st">&quot;tpr&quot;</span>)<span class="op">@</span>y.values[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb159-6" data-line-number="6">                        <span class="dt">CutOffs =</span> <span class="kw">performance</span>(prob.pred, <span class="st">&quot;err&quot;</span>)<span class="op">@</span>x.values[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb159-7" data-line-number="7"></a>
<a class="sourceLine" id="cb159-8" data-line-number="8"><span class="co"># plot tasas de error</span></a>
<a class="sourceLine" id="cb159-9" data-line-number="9">errores.lda &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_perfor, <span class="kw">aes</span>(<span class="dt">x =</span> CutOffs)) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> Error.Rate, <span class="dt">colour =</span> <span class="st">&quot;Tasa Error General&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> FNR, <span class="dt">colour =</span> <span class="st">&quot;FNR&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> FPR, <span class="dt">colour =</span> <span class="st">&quot;FPR&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="dt">name =</span> <span class="st">&quot;Medidas&quot;</span> ) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-14" data-line-number="14"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Puntos de corte&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Tasas de Error&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb159-15" data-line-number="15"><span class="st">  </span><span class="kw">theme_light</span>()</a>
<a class="sourceLine" id="cb159-16" data-line-number="16">errores.lda</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-68-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>La curva ROC podemos hacerla en <code>ggplot</code> como se muestra a continuación:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1"><span class="co"># plot de la curva ROC</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2">roc.lda &lt;-<span class="st"> </span><span class="kw">ggplot</span>(df_perfor, <span class="kw">aes</span>(<span class="dt">x =</span> FPR, <span class="dt">y =</span> TPR)) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;FPR: 1- especificidad&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;TPR: sensibilidad&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-5" data-line-number="5"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">&quot;Curva ROC - LDA (Area Under Curve = &quot;</span>, <span class="kw">round</span>(auc.lda, <span class="dt">digits =</span> <span class="dv">3</span>),<span class="st">&quot;)&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb160-6" data-line-number="6"><span class="st">  </span><span class="kw">theme_light</span>()</a>
<a class="sourceLine" id="cb160-7" data-line-number="7">roc.lda</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-69-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="análisis-en-la-muestra-de-entrenamiento" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Análisis en la muestra de entrenamiento</h3>
<p>Por defecto, <code>caret</code> calcula el <code>RMSE</code>, el <code>MAE</code> y el <code>R^2</code> como medidas de precisión en el caso de la regresión. En problemas de clasificación, por defecto se computa <code>Accuracy</code> y <code>Kappa</code>, como hemos visto hasta ahora. En el caso de la estimación de los parámetros, se emplea <code>RMSE</code> y <code>Accuracy</code> por defecto. De hecho, el argumento <code>metric</code> de la función <code>train</code> permite al usuario el criterio que desee.</p>
<p>En el caso de clasificación binaria es posible emplear las curvas ROC para comparar el rendimiento entre modelos, justo como hicimos con el <code>Accuracy</code>. Ahora, en lugar de estimar la clase correspondiente, es necesario calcular las probabilidades de cada clase (hacer <code>classProbs = T</code> en el <code>trainControl</code>) y debemos agregar la opción <code>summaryFunction = twoClassSummary</code>:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="co"># definimos como control una validación cruzada con 10 hojas y repeticiones</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2">fit_control &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method =</span> <span class="st">&quot;repeatedcv&quot;</span>,</a>
<a class="sourceLine" id="cb161-3" data-line-number="3">                           <span class="dt">number =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb161-4" data-line-number="4">                           <span class="dt">repeats =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb161-5" data-line-number="5">                           <span class="co">## Estimar las probabilidades:</span></a>
<a class="sourceLine" id="cb161-6" data-line-number="6">                           <span class="dt">classProbs =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb161-7" data-line-number="7">                           <span class="co">## Evaluar rendimiento del modelo:</span></a>
<a class="sourceLine" id="cb161-8" data-line-number="8">                           <span class="dt">summaryFunction =</span> twoClassSummary)</a>
<a class="sourceLine" id="cb161-9" data-line-number="9"></a>
<a class="sourceLine" id="cb161-10" data-line-number="10"><span class="co"># LDA</span></a>
<a class="sourceLine" id="cb161-11" data-line-number="11"><span class="kw">set.seed</span>(<span class="dv">321</span>)</a>
<a class="sourceLine" id="cb161-12" data-line-number="12">model_lda_def &lt;-<span class="st"> </span><span class="kw">train</span>(default <span class="op">~</span>.,</a>
<a class="sourceLine" id="cb161-13" data-line-number="13">                       <span class="dt">data =</span> train_df,</a>
<a class="sourceLine" id="cb161-14" data-line-number="14">                       <span class="dt">method =</span> <span class="st">&quot;lda&quot;</span>,</a>
<a class="sourceLine" id="cb161-15" data-line-number="15">                       <span class="dt">trControl =</span> fit_control,</a>
<a class="sourceLine" id="cb161-16" data-line-number="16">                       <span class="co">## Especificamos la métrica para optimizar:</span></a>
<a class="sourceLine" id="cb161-17" data-line-number="17">                       <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>)</a>
<a class="sourceLine" id="cb161-18" data-line-number="18"><span class="co"># QDA</span></a>
<a class="sourceLine" id="cb161-19" data-line-number="19"><span class="kw">set.seed</span>(<span class="dv">321</span>)</a>
<a class="sourceLine" id="cb161-20" data-line-number="20">model_qda_def &lt;-<span class="st"> </span><span class="kw">train</span>(default <span class="op">~</span>.,</a>
<a class="sourceLine" id="cb161-21" data-line-number="21">                       <span class="dt">data =</span> train_df,</a>
<a class="sourceLine" id="cb161-22" data-line-number="22">                       <span class="dt">method =</span> <span class="st">&quot;qda&quot;</span>,</a>
<a class="sourceLine" id="cb161-23" data-line-number="23">                       <span class="dt">trControl =</span> fit_control,</a>
<a class="sourceLine" id="cb161-24" data-line-number="24">                       <span class="co">## Especificamos la métrica para optimizar:</span></a>
<a class="sourceLine" id="cb161-25" data-line-number="25">                       <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>)</a>
<a class="sourceLine" id="cb161-26" data-line-number="26"></a>
<a class="sourceLine" id="cb161-27" data-line-number="27"><span class="co"># RDA</span></a>
<a class="sourceLine" id="cb161-28" data-line-number="28"></a>
<a class="sourceLine" id="cb161-29" data-line-number="29">mi.grid &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">lambda =</span> <span class="kw">c</span>(<span class="dv">0</span>) , </a>
<a class="sourceLine" id="cb161-30" data-line-number="30">                       <span class="dt">gamma =</span> <span class="kw">c</span>(<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb161-31" data-line-number="31"></a>
<a class="sourceLine" id="cb161-32" data-line-number="32"><span class="kw">set.seed</span>(<span class="dv">321</span>)</a>
<a class="sourceLine" id="cb161-33" data-line-number="33">model_rda_def &lt;-<span class="st"> </span><span class="kw">train</span>(default <span class="op">~</span>.,</a>
<a class="sourceLine" id="cb161-34" data-line-number="34">                       <span class="dt">data =</span> train_df,</a>
<a class="sourceLine" id="cb161-35" data-line-number="35">                       <span class="dt">method =</span> <span class="st">&quot;rda&quot;</span>,</a>
<a class="sourceLine" id="cb161-36" data-line-number="36">                       <span class="dt">tuneGrid =</span> mi.grid,</a>
<a class="sourceLine" id="cb161-37" data-line-number="37">                       <span class="dt">trControl =</span> fit_control,</a>
<a class="sourceLine" id="cb161-38" data-line-number="38">                       <span class="co">## Especificamos la métrica para optimizar:</span></a>
<a class="sourceLine" id="cb161-39" data-line-number="39">                       <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>)</a>
<a class="sourceLine" id="cb161-40" data-line-number="40"></a>
<a class="sourceLine" id="cb161-41" data-line-number="41"><span class="kw">set.seed</span>(<span class="dv">321</span>)</a>
<a class="sourceLine" id="cb161-42" data-line-number="42">model_knn_def &lt;-<span class="st"> </span><span class="kw">train</span>(default <span class="op">~</span>.,</a>
<a class="sourceLine" id="cb161-43" data-line-number="43">                       <span class="dt">data =</span> train_df,</a>
<a class="sourceLine" id="cb161-44" data-line-number="44">                       <span class="dt">method =</span> <span class="st">&quot;knn&quot;</span>,</a>
<a class="sourceLine" id="cb161-45" data-line-number="45">                       <span class="dt">trControl =</span> fit_control,</a>
<a class="sourceLine" id="cb161-46" data-line-number="46">                       <span class="dt">preProcess =</span> <span class="kw">c</span>(<span class="st">&quot;center&quot;</span>, <span class="st">&quot;scale&quot;</span>),</a>
<a class="sourceLine" id="cb161-47" data-line-number="47">                       <span class="dt">tuneLength =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb161-48" data-line-number="48">                       <span class="co">## Especificamos la métrica para optimizar:</span></a>
<a class="sourceLine" id="cb161-49" data-line-number="49">                       <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>)</a>
<a class="sourceLine" id="cb161-50" data-line-number="50">model_knn_def</a></code></pre></div>
<pre><code>## k-Nearest Neighbors 
## 
## 8001 samples
##    2 predictor
##    2 classes: &#39;No&#39;, &#39;Yes&#39; 
## 
## Pre-processing: centered (2), scaled (2) 
## Resampling: Cross-Validated (10 fold, repeated 5 times) 
## Summary of sample sizes: 7200, 7200, 7201, 7201, 7201, 7201, ... 
## Resampling results across tuning parameters:
## 
##   k   ROC        Sens       Spec     
##    5  0.7988217  0.9933019  0.3594302
##    7  0.8170610  0.9936381  0.3722792
##    9  0.8328763  0.9947759  0.3684330
##   11  0.8508985  0.9950345  0.3602849
##   13  0.8614489  0.9956036  0.3498575
## 
## ROC was used to select the optimal model using the largest value.
## The final value used for the model was k = 13.</code></pre>
<p>Usamos una vez más la función <code>resamples</code> para agrupar todos los resultados calculados de cada modelo:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">resamps &lt;-<span class="st"> </span><span class="kw">resamples</span>(<span class="kw">list</span>(<span class="dt">LDA =</span> model_lda_def,</a>
<a class="sourceLine" id="cb163-2" data-line-number="2">                          <span class="dt">QDA =</span> model_qda_def,</a>
<a class="sourceLine" id="cb163-3" data-line-number="3">                          <span class="dt">RDA =</span> model_rda_def,</a>
<a class="sourceLine" id="cb163-4" data-line-number="4">                          <span class="dt">KNN =</span> model_knn_def))</a>
<a class="sourceLine" id="cb163-5" data-line-number="5">resamps</a></code></pre></div>
<pre><code>## 
## Call:
## resamples.default(x = list(LDA = model_lda_def, QDA = model_qda_def, RDA
##  = model_rda_def, KNN = model_knn_def))
## 
## Models: LDA, QDA, RDA, KNN 
## Number of resamples: 50 
## Performance metrics: ROC, Sens, Spec 
## Time estimates for: everything, final model fit</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw">summary</span>(resamps)</a></code></pre></div>
<pre><code>## 
## Call:
## summary.resamples(object = resamps)
## 
## Models: LDA, QDA, RDA, KNN 
## Number of resamples: 50 
## 
## ROC 
##          Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
## LDA 0.8957110 0.9386303 0.9524699 0.9476517 0.9609670 0.9730248    0
## QDA 0.8959100 0.9386739 0.9519189 0.9474556 0.9607047 0.9725936    0
## RDA 0.8959100 0.9386739 0.9519189 0.9474556 0.9607047 0.9725936    0
## KNN 0.7301416 0.8398544 0.8648040 0.8614489 0.8882339 0.9492118    0
## 
## Sens 
##          Min.   1st Qu.    Median      Mean   3rd Qu. Max. NA&#39;s
## LDA 0.9948320 0.9974127 0.9980612 0.9981379 0.9996770    1    0
## QDA 0.9935317 0.9961190 0.9974127 0.9973362 0.9987063    1    0
## RDA 0.9935317 0.9961190 0.9974127 0.9973362 0.9987063    1    0
## KNN 0.9909444 0.9948254 0.9961190 0.9956036 0.9970905    1    0
## 
## Spec 
##           Min.   1st Qu.    Median      Mean   3rd Qu.      Max. NA&#39;s
## LDA 0.07407407 0.1869658 0.2307692 0.2524786 0.2962963 0.4615385    0
## QDA 0.11111111 0.1997863 0.2642450 0.2794017 0.3333333 0.4814815    0
## RDA 0.11111111 0.1997863 0.2642450 0.2794017 0.3333333 0.4814815    0
## KNN 0.18518519 0.2962963 0.3333333 0.3498575 0.4074074 0.5925926    0</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="co"># box plots</span></a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="kw">bwplot</span>(resamps, <span class="dt">metric =</span> <span class="st">&quot;ROC&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-72-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>Los 3 métodos Discriminantes se comportan de forma similar, lo cual es de esperar ya que los hemos entrenado poco por cuestiones prácticas (¡demoran!). El KNN parece ser el peor de todos, pero tampoco hemos puesto mucho empeño en calcular el número óptimo de vecinos. Aún así, estos valores de AUC son muy buenos, en la práctica es difícil conseguir estos resultados.</p>
<p>Pasamos a hacer algunas inferencias. Particularmente, vamos a calcular las diferencias (2 a 2) y luego hacer un t-test bajo la hipótesis nula de que no hay diferencias entre modelos.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">difValues &lt;-<span class="st"> </span><span class="kw">diff</span>(resamps)</a>
<a class="sourceLine" id="cb168-2" data-line-number="2">difValues</a></code></pre></div>
<pre><code>## 
## Call:
## diff.resamples(x = resamps)
## 
## Models: LDA, QDA, RDA, KNN 
## Metrics: ROC, Sens, Spec 
## Number of differences: 6 
## p-value adjustment: bonferroni</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1"><span class="kw">summary</span>(difValues)</a></code></pre></div>
<pre><code>## 
## Call:
## summary.diff.resamples(object = difValues)
## 
## p-value adjustment: bonferroni 
## Upper diagonal: estimates of the difference
## Lower diagonal: p-value for H0: difference = 0
## 
## ROC 
##     LDA     QDA       RDA       KNN      
## LDA         0.0001961 0.0001961 0.0862029
## QDA 0.05335           0.0000000 0.0860067
## RDA 0.05335 NA                  0.0860067
## KNN &lt; 2e-16 &lt; 2e-16   &lt; 2e-16            
## 
## Sens 
##     LDA       QDA       RDA       KNN      
## LDA           0.0008017 0.0008017 0.0025343
## QDA 4.441e-06           0.0000000 0.0017326
## RDA 4.441e-06 NA                  0.0017326
## KNN 1.367e-12 1.261e-08 1.261e-08          
## 
## Spec 
##     LDA       QDA       RDA       KNN     
## LDA           -0.02692  -0.02692  -0.09738
## QDA 1.942e-07            0.00000  -0.07046
## RDA 1.942e-07 NA                  -0.07046
## KNN &lt; 2.2e-16 9.408e-14 9.408e-14</code></pre>
<p>Los resultados indican lo que sospechábamos: hay diferencias significativas entre los modelos <em>(X)DA</em> y el <em>KNN</em> (p-valor <span class="math inline">\(&gt; 0.05\)</span>). En estos casos, hacer un diagrama con los intervalos de confianza es mucho más ilustrativo.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1"><span class="co"># intervalos de confianza para las diferencias</span></a>
<a class="sourceLine" id="cb172-2" data-line-number="2"><span class="kw">dotplot</span>(difValues)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-74-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>En la práctica, el siguiente paso sería escoger el modelo más competitivo de acuerdo a alguno de los criterios estudiados y, con este, predecir las respuestas de la muestra test.</p>

</div>
</div>
<!-- </div> -->
<h3>Bibliografía</h3>
<div id="refs" class="references">
<div id="ref-R-ROCR">
<p>Sing, Tobias, Oliver Sander, Niko Beerenwinkel, and Thomas Lengauer. 2015. <em>ROCR: Visualizing the Performance of Scoring Classifiers</em>. <a href="https://CRAN.R-project.org/package=ROCR">https://CRAN.R-project.org/package=ROCR</a>.</p>
</div>
</div>
<p style="text-align: center;">
<a href="4-1-comparando-según-accuracy.html"><button class="btn btn-default">Previous</button></a>
<a href="5-wiscon.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
